<html>
  <head>
    <meta http-equiv ="content-type" content="text/html;charset=ISO-8859-1">
    <script type="text/javascript" src="glMatrix-0.9.5.min.js"></script>
  </head>
  
// initGL function.  Asks the canvas it is given, for the context. 
// Once the context os received, JS allows to set any property on any object to store on it the width and the height of the canvas.
// So that it can be used in the code that sets up the viewport and the perspecitive at the start of drawScene.  
// GL context is now set up!

 var gl;
  function initGL(canvas) {
    try {
      gl = canvas.getContext("experimental-webgl");
      gl.viewportWidth = canvas.width;
      gl.viewportHeight = canvas.height;
    } catch(e) {
    }
    if (!gl) {
      alert("Could not initialise WebGL, mis discuplas");
    }
  }
  
// Model-view matrix set to empty.
// Projection matrix set to empty.
//
// Set up the WebGL shaders.
//
// Attach "fragment shader" and "vertex shader" to "program".
//
// Make the attribute vertexPositionAttribute a new field of the "program".
//
// Store two uniform variables on the "program" object.
// initShaders is complete!

var mvMatrix = mat4.create();
var pMatrix = mat4.create();

 var shaderProgram;
  function initShaders() {
    var fragmentShader = getShader(gl, "shader-fs");
    var vertexShader = getShader(gl, "shader-vs");

    shaderProgram = gl.createProgram();
    gl.attachShader(shaderProgram, vertexShader);
    gl.attachShader(shaderProgram, fragmentShader);
    gl.linkProgram(shaderProgram);

    if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
      alert("Could not initialise shaders");
    }

    gl.useProgram(shaderProgram);
  
    shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, "aVertexPosition");
    gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);
  
    shaderProgram.pMatrixUniform = gl.getUniformLocation(shaderProgram, "uPMatrix");
    shaderProgram.mvMatrixUniform = gl.getUniformLocation(shaderProgram, "uMVMatrix");
  }
  
  
// getShader function

function getShader(gl, id) {
      var shaderScript = document.getElementById(id);
      if (!shaderScript) {
          return null;
      }

      var str = "";
      var k = shaderScript.firstChild;
      while (k) {
          if (k.nodeType == 3)
              str += k.textContent;
          k = k.nextSibling;
      }

      var shader;
      if (shaderScript.type == "x-shader/x-fragment") {
          shader = gl.createShader(gl.FRAGMENT_SHADER);
      } else if (shaderScript.type == "x-shader/x-vertex") {
          shader = gl.createShader(gl.VERTEX_SHADER);
      } else {
          return null;
      }

      gl.shaderSource(shader, str);
      gl.compileShader(shader);

      if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
          alert(gl.getShaderInfoLog(shader));
          return null;
      }

      return shader;
  }
  
  // Use the uniform variables that represent our projection matrix and our model-view matrix that is in initShaders.
  // Send WebGL the values from the projection and model-view matrices.
  
    function setMatrixUniforms() {
    gl.uniformMatrix4fv(shaderProgram.pMatrixUniform, false, pMatrix);
    gl.uniformMatrix4fv(shaderProgram.mvMatrixUniform, false, mvMatrix);
  }
  
  
// Initialize WebGl, canvas element, shaders, and buffers.  
//
// Sets up 'clear canvas' and 'depth testing' methods on a gl object.
//
// Draws a triangle and a square, using the buffers.

  function webGLStart() {
    var canvas = document.getElementById("lesson01-canvas");
    initGL(canvas);
    initShaders();
    initBuffers();

    gl.clearColor(0.0, 0.0, 0.0, 1.0);
    gl.enable(gl.DEPTH_TEST);

    drawScene();
  }


// Declare two global variable to hold the buffers.

  var triangleVertexPositionBuffer;
  var squareVertexPositionBuffer;


// Create a buffer for the triangle's vertex positions.
//
//Instructs WebGL that any following operations that act on buffers should use the one we specify.
//
//Define our vertex positions as a JavaScript list (the centre of the isosceles triangle is at (0,0,0)).
//
//Create Float32Array object (based on the vertices JS list) and instructing WebGL to use it to fill the triangleVertexPositionBuffer).
//
//Set two new properties on the buffer.  Now the buffer is set up for the triangle!
//
//Repeat for the Square.  The square has four vertex positions, thus the array will be bigger and the numItems will be increased.

  function initBuffers() {
    triangleVertexPositionBuffer = gl.createBuffer();
    
    gl.bindBuffer(gl.ARRAY_BUFFER, triangleVertexPositionBuffer); 
    
    var vertices = [
                    0.0, 1.0, 0.0,
                   -1.0,-1.0, 0.0,
                    1.0,-1.0, 0.0
                    ];
                    
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices) gl.STATIC_DRAW);
    
   triangleVertexPositionBuffer.itemSize = 3;
   triangleVertexPositionBuffer.numItems = 3;

   squareVertexPositionBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, squareVertexPositionBuffer);
     vertices = [
         1.0,  1.0,  0.0,
        -1.0,  1.0,  0.0,
         1.0, -1.0,  0.0,
        -1.0, -1.0,  0.0
     ];
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
     squareVertexPositionBuffer.itemSize = 3;
     squareVertexPositionBuffer.numItems = 4;
  }
  
  
  
  
// Instruct WebGL about the size of the canvas using the viewport function.
//
// Clear the canvas.
//
// Perspective setup: (vertical) field of view is 45Â°; canvas' aspect ratio; remove objects closer than 0.1 and farther than 100 units.)
//
// Set up the identity matrix (4x4) and model-vew matrix to represent all of the transformations in one (in OpenGL).
//
// Draw the triangle on the left-hand side of the canvas. 
// mat4.translate menas "multiply the given matrix by a translation matrix with the following parameters (x,y,z)."
// Moving 1.5 units to the left (x-axis) and seven units into the scene (z-axis). 
//
// Specify the triangleVertexPositionBuffer, then instructing WebGL that the values in it should be used for vertex positions.
//
// Instruct WebGL to take account of our current model-vew matrix and also the projection matrix (in OpenGL).
//
// Draw the array of vertices as triangles, starting with item 0 in the array and going up to the numItems.  The triangle is now drawn!
//
// Draw the square.  
// Start by moving the model-view matrix three units to the right.
//
// This positions the mvMatrix 1.5 to the right(x-axis) and 7 away(z-axis).
//
// Instruct WebGL to use our square's buffer for its vertex positions.
// Take account of the current model-view matrix and projection matrices (so that the last mvTranslate is accounted for).
// Draw the array of vertices earlier as a strip of triangles, as a quicker way of specifying a square.
// The drawScene function is complete!

function drawScene() {
  gl.viewport(0,0,gl.viewportWidth,gl.viewportHeight);
  
  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
  
  mat4.perspective(45, gl.viewportWidth / gl.viewportHeight, 0.1, 100.0 pMatrix);
  
  mat4.identity(myMatrix);
  
  mat4.translate(mvMatrix, [-1.5, 0.0, -7.0]);
  
  gl.bindBuffer(gl.ARRAY_BUFFER, triangleVertexPositionBuffer);
  gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, triangleVertexPositionBuffer.itemSize, gl.FLOAT, false, 0, 0);
  
  setMatrixUniforms();
  
  gl.drawArrays(gl.TRIANGLES, 0, triangleVertexPositionBuffer.numItems);
  
  mat4.translate(mvMatrix, [3.0, 0.0, 0.0]);
  
  gl.bindBuffer(gl.ARRAY_BUFFER, squareVertexPositionBuffer);
  gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, squareVertexPositionBuffer.itemSize, gl.FLOAT, false, 0, 0);
  setMatrixUniforms();
  gl.drawArrays(gl.TRIANGLE_STRIP, 0, squareVertexPositionBuffer.numItems);
  }
  

// Below is the complete body of the page.

<body onload="webGLStart();">
  <a href="https://github.com/LDPJ/Earth/blob/gh-pages/index.html">&lt;&lt; Back to GitHub </a><br />

  <canvas id="lesson01-canvas" style="border: none;" width="500" height="500"></canvas>

  <br/>
  <a href="https://github.com/LDPJ/Earth/blob/gh-pages/index.html">&lt;&lt; Back to GitHub </a><br />
</body>
</html>
